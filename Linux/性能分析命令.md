# 性能分析命令

## 1 top/htop

### 1.1 各项含义

![](http://base422.oss-cn-beijing.aliyuncs.com/linuxtop.png)

### 1.2 对top排序

1. **按`b`高亮显示当前运行进程**

2. **按`x`高亮显示当前按照哪一个指标进行排序**

3. **按`shift+<`或`shift+>`更改排序指标**

   1. **按`M`根据驻留内存大小进行排序**
   2. **按`P`根据CPU使用百分比大小进行排序**
   3. **按`T`根据时间/累计时间进行排序**

   

![](http://base422.oss-cn-beijing.aliyuncs.com/linuxtopsort.png)

### 1.3 查看线程

- **按`H`查看线程**
- **输入 top -Hp ${pid} 查看指定进程的线程运行情况**

![](http://base422.oss-cn-beijing.aliyuncs.com/linuxtopH.png)

### 1.4 查看每个CPU的运行情况

- **按1查看每个CPU的运行情况**

![](http://base422.oss-cn-beijing.aliyuncs.com/linuxtopC.png)

### 1.5 htop

**交互式的top命令,还可以用鼠标点,贼好使**

![](http://base422.oss-cn-beijing.aliyuncs.com/linuxhtop.png)



## 2 ps/pstree

### 2.1 ps -aux

**ps -aux   列出目前所有的正在内存当中的程序**

![](http://base422.oss-cn-beijing.aliyuncs.com/linuxps.png)



### 2.2 ps -ajx

**ps -ajx 以完整的格式显示所有的进程**



### 2.3 ps -H -p ${pid}

 **ps -H -p ${pid} 查看指定pid的所有线程**

### 2.4 stat字段含义

```shell
D  不能中断的进程（通常为IO）
R  正在运行中的进程
S  已经中断的进程，通常情况下，系统中大部分进程都是这个状态
T  已经停止或者暂停的进程，如果我们正在运行一个命令，比如说sleep 10，如果我们按一下ctrl -z 让他暂停，那么我们用ps查看就会显示T这个状态
W 这个好像是说，从内核2.6xx 以后，表示为没有足够的内存页分配
X  已经死掉的进程（这个好像从来不会出现）
Z  僵尸进程，杀不掉，打不死的垃圾进程，占系统一小点资源，不过没有关系。如果太多，就有问题了。一般不会出现。
I 　idle空闲状态
<  高优先级进程
N  低优先级进程
L   在内存中被锁了内存分页
s   主进程
l   多线程进程
+  代表在前台运行的进程
```

### 2.5 pstree

树形输出进程之间的关系

**pstree -p　显示当前所有进程的进程号和进程id**　

**pstree -p ${pid}　显示指定进程的进程号和进程id**　



```shell
ken@Ken:~/Desktop$ pstree -p 782
chrome(782)─┬─{Chrome_ChildIOT}(786)
            ├─{CompositorTileW}(790)
            ├─{CompositorTileW}(791)
            ├─{CompositorTileW}(792)
            ├─{Compositor}(789)
            ├─{Font_Proxy_Thre}(788)
            ├─{GpuMemoryThread}(787)
            ├─{MemoryInfra}(878)
            ├─{TaskSchedulerFo}(785)
            ├─{TaskSchedulerFo}(58151)
            └─{TaskSchedulerSe}(783)

```



## 3 mpstat

mpstat是MultiProcessor Statistics的缩写，是实时系统监控工具。报告CPU的一些统计信息，这些信息存放在/proc/stat文件中。在多CPUs系统里，其不但能查看所有CPU的平均状况信息，而且能够查看特定CPU的信息。

### 3.1 语法

```shell
mpstat [-P {|ALL}] [internal [count]]

参数：
    （1）-P {|ALL}：表示监控哪个CPU，在[0,cpu个数-1]中取值；  
    （2）internal：相邻的两次采样的间隔时间；
    （3）count：采样的次数，count只能和delay一起使用；

    备注：当没有参数时，mpstat则显示系统启动以后所有信息的平均值。有interval时，第一行的信息自系统启动以来的平均信息。从第二行开始，输出为前一个interval时间段的平均信息。
```

### 3.2 demo

```shell
ken@Ken:~$ mpstat -P ALL 1 2
Linux 4.15.0-30deepin-generic (Ken) 	2019年12月03日 	_x86_64_	(4 CPU)

21时57分15秒  CPU    %usr   %nice    %sys %iowait    %irq   %soft  %steal  %guest  %gnice   %idle
21时57分16秒  all   12.06    0.00   13.57    0.00    0.00    0.25    0.00    0.00    0.00   74.12
21时57分16秒    0    1.01    0.00    1.01    0.00    0.00    0.00    0.00    0.00    0.00   97.98
21时57分16秒    1    0.00    0.00    0.00    0.00    0.00    0.00    0.00    0.00    0.00  100.00
21时57分16秒    2    0.00    0.00    0.00    0.00    0.00    0.00    0.00    0.00    0.00  100.00
21时57分16秒    3   47.00    0.00   53.00    0.00    0.00    0.00    0.00    0.00    0.00    0.00

21时57分16秒  CPU    %usr   %nice    %sys %iowait    %irq   %soft  %steal  %guest  %gnice   %idle
21时57分17秒  all   13.10    0.00   12.34    0.00    0.00    0.00    0.00    0.00    0.00   74.56
21时57分17秒    0    0.00    0.00    0.00    0.00    0.00    1.00    0.00    0.00    0.00   99.00
21时57分17秒    1    1.00    0.00    0.00    0.00    0.00    0.00    0.00    0.00    0.00   99.00
21时57分17秒    2    1.01    0.00    0.00    0.00    0.00    0.00    0.00    0.00    0.00   98.99
21时57分17秒    3   51.00    0.00   49.00    0.00    0.00    0.00    0.00    0.00    0.00    0.00

平均时间:  CPU    %usr   %nice    %sys %iowait    %irq   %soft  %steal  %guest  %gnice   %idle
平均时间:  all   12.58    0.00   12.96    0.00    0.00    0.13    0.00    0.00    0.00   74.34
平均时间:    0    0.50    0.00    0.50    0.00    0.00    0.50    0.00    0.00    0.00   98.49
平均时间:    1    0.50    0.00    0.00    0.00    0.00    0.00    0.00    0.00    0.00   99.50
平均时间:    2    0.51    0.00    0.00    0.00    0.00    0.00    0.00    0.00    0.00   99.49
平均时间:    3   49.00    0.00   51.00    0.00    0.00    0.00    0.00    0.00    0.00    0.00

```



## 4 iostat

## 5 vmstat

## 6 df/du



