# 5 进程间关系

## 5.1 进程组

**一个或多个进程的集合,进程组ID是一个正整数**。 用来获得当前进程进程组ID的函数

```c
pid_t getpgid(pid_t pid)
pid_t getpgrp(void)
```

- **组长进程标识:其进程组ID==其进程ID**
- **组长进程可以创建一个进程组，创建该进程组中的进程，然后终止,只要进程组中有一个进程存在，进程组就存在，与组长进程是否终止无关**
- **进程组生存期:进程组创建到最后一个进程离开(终止或转移到另一个进程组)**
- **一个进程可以为自己或子进程设置进程组ID**

### 5.1.1 设置进程组

```c
int setpgid(pid_t pid, pid_t pgid)
如改变子进程为新的组，应在fork后，exec前使用
非root进程只能改变自己创建的子进程，或有权限操作的进程
```

#### 5.1.1.1 demo

```c
#include <stdio.h>
#include <stdlib.h>
#include <unistd.h>
int main(void) {
    pid_t pid;
    if ((pid = fork()) < 0) {
        perror("fork");
        exit(1);
    } else if (pid == 0) {
        printf("child process PID is %d\n", getpid());
        printf("Group ID of child is %d\n", getpgid(0)); // 返回组id
        sleep(5);
        printf("Group ID of child is changed to %d\n", getpgid(0));
        exit(0);
    }
    sleep(1);
    setpgid(pid, pid); // 父进程改变子进程的组id为子进程本身
    sleep(5);
    printf("parent process PID is %d\n", getpid());
    printf("parent of parent process PID is %d\n", getppid());
    printf("Group ID of parent is %d\n", getpgid(0));
    setpgid(getpid(), getppid()); // 改变父进程的组id为父进程的父进程
    printf("Group ID of parent is changed to %d\n", getpgid(0));
    return 0;
}
```



## 5.1 会话

### 5.1.1 设置会话

```c
pid_t setsid(void)
```

- **调用进程不能是进程组组长,该进程变成新会话首进程(session header)** 
- **该进程成为一个新进程组的组长进程。** 
- **需有root权限** 
- **新会话丢弃原有的控制终端,该会话没有控制终端** 
- **该调用进程是组长进程，则出错返回 **
- **建立新会话时，先调用fork, 父进程终止，子进程调用**


### 5.1.２ demo

```c

#include <stdio.h>
#include <stdlib.h>
#include <unistd.h>
int main(void)
{
    pid_t pid;
    if ((pid = fork())<0) {
        perror("fork");
        exit(1);
    } else if (pid == 0) {
        printf("child process PID is %d\n", getpid());
        printf("Group ID of child is %d\n", getpgid(0));
        printf("Session ID of child is %d\n", getsid(0));
        sleep(10);
        setsid(); // 子进程非组长进程，故其成为新会话首进程，且成为组长进程。该进程组id即为会话进程
        printf("Changed:\n");
        printf("child process PID is %d\n", getpid());
        printf("Group ID of child is %d\n", getpgid(0));
        printf("Session ID of child is %d\n", getsid(0));
        sleep(20);
        exit(0);
    }
    return 0;
}

```








